<!doctype html>
<html lang="en" data-theme="light">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Certification Flash Cards</title>
        <link rel="stylesheet" href="styles.css" />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
        />
        <style>
            :root[data-theme="light"] {
                --bg-primary: #f5f8fa;
                --bg-secondary: #ffffff;
                --text-primary: #2c3e50;
                --text-secondary: #34495e;
                --accent-primary: #3b6b98;
                --accent-secondary: #4a8db7;
                --border-color: #d1e3f0;
                --shadow-color: rgba(0, 0, 0, 0.1);
                --correct-color: #2ecc71;
                --incorrect-color: #e74c3c;
            }

            :root[data-theme="dark"] {
                --bg-primary: #1a2634;
                --bg-secondary: #0f1924;
                --text-primary: #e2e8f0;
                --text-secondary: #a0aec0;
                --accent-primary: #4a8db7;
                --accent-secondary: #3b6b98;
                --border-color: #2d4054;
                --shadow-color: rgba(0, 0, 0, 0.25);
                --correct-color: #2d8a54;
                --incorrect-color: #a83a2d;
            }

            body {
                background-color: var(--bg-primary);
                color: var(--text-primary);
                font-family: "Crimson Text", Georgia, serif;
                line-height: 1.6;
                transition:
                    background-color 0.3s,
                    color 0.3s;
            }

            #cert-title {
                color: var(--text-primary);
                transition: color 0.3s;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 10px;
            }

            header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px 0;
                border-bottom: 2px solid var(--border-color);
                margin-bottom: 20px;
            }

            .logo {
                display: flex;
                align-items: center;
                gap: 15px;
                margin: 0 auto;
            }

            .logo i {
                font-size: 2rem;
                color: var(--accent-primary);
            }

            h1,
            h2 {
                color: var(--text-primary);
                margin-bottom: 1rem;
            }

            h1 {
                font-size: 1.8rem;
                margin: 0;
            }

            .theme-toggle {
                background: none;
                border: 2px solid var(--border-color);
                color: var(--text-primary);
                padding: 8px;
                border-radius: 50%;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-family: inherit;
                transition: all 0.3s;
                width: 35px;
                height: 35px;
            }

            .theme-toggle:hover {
                background-color: var(--accent-primary);
                color: var(--bg-secondary);
                border-color: var(--accent-primary);
            }

            .stats {
                color: var(--text-secondary);
                font-size: 1.1rem;
                margin-left: 15px;
                display: inline-block;
                white-space: nowrap;
            }

            .cert-selection {
                display: flex;
                flex-direction: column;
                gap: 20px;
                margin-top: 30px;
                width: 100%;
            }

            .cert-card {
                background-color: var(--bg-secondary);
                border-radius: 8px;
                box-shadow: 0 4px 6px var(--shadow-color);
                padding: 20px;
                cursor: pointer;
                transition:
                    transform 0.3s,
                    box-shadow 0.3s;
                display: flex;
                align-items: center;
                border-left: 5px solid var(--accent-primary);
            }

            .cert-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 8px 16px var(--shadow-color);
            }

            .cert-card.aws {
                border-left-color: var(--accent-primary);
            }

            .cert-card.kafka {
                border-left-color: var(--accent-primary);
            }

            .cert-card.ccco {
                border-left-color: var(--accent-primary);
            }

            .cert-icon {
                font-size: 2.5rem;
                margin-right: 20px;
                color: var(--accent-primary);
            }

            .cert-icon.aws {
                color: var(--accent-primary);
            }

            .cert-icon.kafka {
                color: var(--accent-primary);
            }

            .cert-icon.ccco {
                color: var(--accent-primary);
            }

            .cert-info {
                flex: 1;
                text-align: left;
            }

            .cert-info h3 {
                margin: 0 0 10px 0;
                color: var(--text-primary);
            }

            .cert-info p {
                margin: 0;
                color: var(--text-secondary);
            }

            .back-button {
                position: absolute;
                top: 10px;
                left: 10px;
                background: none;
                border: none;
                color: var(--text-secondary);
                font-size: 1rem;
                cursor: pointer;
                display: flex;
                align-items: center;
                gap: 5px;
                padding: 5px 10px;
                border-radius: 4px;
                transition: background-color 0.2s;
            }

            .back-button:hover {
                color: var(--accent-primary);
            }

            .cert-title-container {
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 40px auto 20px;
                width: auto;
                min-width: min-content;
                white-space: nowrap;
            }

            .cert-title {
                font-size: 1.2rem;
                color: var(--text-secondary);
                margin-top: 0;
                white-space: nowrap;
            }

            /* Search Styles */
            .search-container {
                width: 100%;
                max-width: 600px;
                margin: 0 auto 20px;
            }

            .search-input-wrapper {
                position: relative;
                display: flex;
                align-items: center;
            }

            .search-input {
                width: 100%;
                padding: 10px 40px 10px 15px;
                font-size: 1rem;
                border: 2px solid var(--border-color);
                border-radius: 25px;
                background-color: var(--bg-secondary);
                color: var(--text-primary);
                transition: all 0.3s;
            }

            .search-input:focus {
                outline: none;
                border-color: var(--accent-primary);
                box-shadow: 0 0 0 3px rgba(59, 107, 152, 0.1);
            }

            .clear-search-btn {
                position: absolute;
                right: 12px;
                background: none;
                border: none;
                color: var(--text-secondary);
                cursor: pointer;
                font-size: 0.9rem;
                padding: 5px;
                display: none;
            }

            .clear-search-btn.visible {
                display: block;
            }

            .clear-search-btn:hover {
                color: var(--accent-primary);
            }

            .search-results {
                margin-top: 8px;
                font-size: 0.9rem;
                color: var(--text-secondary);
                text-align: right;
                transition: opacity 0.3s;
                opacity: 0;
            }

            .search-results.visible {
                opacity: 1;
            }

            /* Card Animation for Filtering */
            @keyframes cardFadeOut {
                from {
                    opacity: 1;
                    transform: scale(1);
                }
                to {
                    opacity: 0;
                    transform: scale(0.8);
                }
            }

            @keyframes cardFadeIn {
                from {
                    opacity: 0;
                    transform: scale(0.8);
                }
                to {
                    opacity: 1;
                    transform: scale(1);
                }
            }

            .card.filtering-out {
                animation: cardFadeOut 0.3s forwards;
            }

            .card.filtering-in {
                animation: cardFadeIn 0.3s forwards;
            }

            .feedback-controls.filtered-mode {
                position: relative;
            }

            .feedback-controls.filtered-mode::after {
                content: "Feedback disabled while filtering";
                position: absolute;
                bottom: -20px;
                left: 0;
                right: 0;
                font-size: 0.8rem;
                color: var(--text-secondary);
                text-align: center;
            }

            .screen {
                display: none;
                text-align: center;
                padding: 20px;
                max-width: 600px;
                margin: 0 auto;
            }

            .screen.active {
                display: block;
            }

            .card-container {
                perspective: 1000px;
                margin: 40px auto;
                width: 100%;
                height: 300px;
            }

            .card {
                position: relative;
                width: 100%;
                height: 100%;
                transform-style: preserve-3d;
                transition: transform 0.6s;
            }

            .card.flipped {
                transform: rotateY(180deg);
            }

            .card-front,
            .card-back {
                position: absolute;
                width: 100%;
                height: 100%;
                backface-visibility: hidden;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
                background-color: var(--bg-secondary);
                border-radius: 12px;
                box-shadow: 0 4px 6px var(--shadow-color);
            }

            .card-back {
                transform: rotateY(180deg);
            }

            .card-content {
                font-size: 1.2rem;
                color: var(--text-primary);
                max-width: 80%;
            }

            .aws-btn {
                background-color: var(--accent-primary);
                color: var(--bg-secondary);
                border: none;
                padding: 12px 24px;
                border-radius: 25px;
                font-size: 1rem;
                cursor: pointer;
                transition: all 0.3s;
            }

            .aws-btn:hover {
                background-color: var(--accent-secondary);
            }

            .aws-btn.secondary {
                background-color: transparent;
                border: 2px solid var(--accent-primary);
                color: var(--text-primary);
            }

            .aws-btn.secondary:hover {
                background-color: var(--accent-primary);
                color: var(--bg-secondary);
            }

            .card-controls {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 20px;
                margin: 20px auto;
                width: 100%;
            }

            .nav-btn {
                background: none;
                border: none;
                color: var(--text-secondary);
                cursor: pointer;
                font-size: 1rem;
                padding: 5px 10px;
                transition: color 0.3s;
            }

            .nav-btn:hover:not(:disabled) {
                color: var(--accent-primary);
            }

            .nav-btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            .feedback-controls {
                display: flex;
                justify-content: center;
                gap: 20px;
                margin: 20px auto;
                width: 100%;
            }

            .feedback-btn {
                padding: 10px 20px;
                border: none;
                border-radius: 20px;
                cursor: pointer;
                font-size: 1rem;
                transition: opacity 0.3s;
                color: var(--bg-secondary);
            }

            .feedback-btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            .feedback-btn.correct {
                background-color: var(--correct-color);
            }

            .feedback-btn.incorrect {
                background-color: var(--incorrect-color);
            }

            .progress-bar {
                width: 100%;
                height: 6px;
                background-color: var(--border-color);
                border-radius: 3px;
                margin: 20px auto;
                overflow: hidden;
            }

            #progress-fill {
                height: 100%;
                background-color: var(--accent-primary);
                transition: width 0.3s;
            }

            .results {
                background-color: var(--bg-secondary);
                padding: 30px;
                border-radius: 12px;
                margin: 30px auto;
                max-width: 400px;
                box-shadow: 0 4px 6px var(--shadow-color);
            }

            .result-item {
                display: flex;
                justify-content: space-between;
                margin: 10px 0;
                padding: 10px 0;
                border-bottom: 1px solid var(--border-color);
            }

            .result-item:last-child {
                border-bottom: none;
            }

            .result-label {
                color: var(--text-secondary);
            }

            .result-value {
                color: var(--text-primary);
                font-weight: bold;
            }

            p {
                color: var(--text-secondary);
            }

            button {
                font-family: inherit;
            }

            .session-controls {
                width: 100%;
                margin: 20px auto;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <header>
                <button id="theme-toggle" class="theme-toggle">
                    <i class="fas fa-sun"></i>
                </button>
                <div class="logo">
                    <i class="fas fa-book"></i>
                    <h1 id="cert-title">Certification Flash Cards</h1>
                </div>
            </header>

            <div id="cert-select-screen" class="screen active">
                <h2>Select Certification</h2>
                <p>Choose which certification you want to study for:</p>

                <div class="cert-selection">
                    <div class="cert-card aws" id="aws-cert">
                        <div class="cert-icon aws">
                            <i class="fab fa-aws"></i>
                        </div>
                        <div class="cert-info">
                            <h3>AWS Certified Solutions Architect Associate</h3>
                            <p>
                                Study AWS services, architecture, and best
                                practices
                            </p>
                        </div>
                    </div>

                    <div class="cert-card kafka" id="kafka-cert">
                        <div class="cert-icon kafka">
                            <i class="fas fa-stream"></i>
                        </div>
                        <div class="cert-info">
                            <h3>
                                Confluent Certified Developer for Apache Kafka
                            </h3>
                            <p>
                                Study Apache Kafka concepts, development, and
                                operations
                            </p>
                        </div>
                    </div>

                    <div class="cert-card ccco" id="ccco-cert">
                        <div class="cert-icon ccco">
                            <i class="fas fa-cloud"></i>
                        </div>
                        <div class="cert-info">
                            <h3>Confluent Certified Cloud Operator</h3>
                            <p>
                                Study Confluent Cloud operations,
                                administration, and best practices
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="card-screen" class="screen">
                <button id="back-to-certs-from-cards" class="back-button">
                    <i class="fas fa-arrow-left"></i> Back to Certifications
                </button>
                <div class="cert-title-container">
                    <div class="cert-title" id="current-cert-title"></div>
                    <div class="stats">
                        (<span id="correct-count">0</span> correct /
                        <span id="total-count">0</span> total)
                    </div>
                </div>

                <!-- Search Container -->
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <input
                            type="text"
                            id="search-input"
                            placeholder="Search cards..."
                            class="search-input"
                        />
                        <button id="clear-search" class="clear-search-btn">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div id="search-results" class="search-results">
                        <span id="filtered-count">0</span> cards found
                    </div>
                </div>

                <div class="progress-bar">
                    <div id="progress-fill"></div>
                </div>
                <div class="card-container">
                    <div class="card" id="flashcard">
                        <div class="card-front">
                            <div class="card-content">
                                <p id="question"></p>
                            </div>
                        </div>
                        <div class="card-back">
                            <div class="card-content">
                                <p id="answer"></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-controls">
                    <button id="prev-btn" class="nav-btn">
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <button id="flip-btn" class="aws-btn">Reveal Answer</button>
                    <button id="next-btn" class="nav-btn">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                <div class="feedback-controls">
                    <button
                        id="correct-btn"
                        class="feedback-btn correct"
                        disabled
                    >
                        <i class="fas fa-check"></i> Correct
                    </button>
                    <button
                        id="incorrect-btn"
                        class="feedback-btn incorrect"
                        disabled
                    >
                        <i class="fas fa-times"></i> Incorrect
                    </button>
                </div>
                <div class="session-controls">
                    <button id="restart-btn" class="aws-btn secondary">
                        Restart Session
                    </button>
                </div>
            </div>

            <div id="finish-screen" class="screen">
                <button id="back-to-certs-from-finish" class="back-button">
                    <i class="fas fa-arrow-left"></i> Back to Certifications
                </button>
                <h2>Session Complete!</h2>
                <div class="results">
                    <div class="result-item">
                        <span class="result-label">Total Cards:</span>
                        <span id="final-total" class="result-value">0</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Correct Answers:</span>
                        <span id="final-correct" class="result-value">0</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Success Rate:</span>
                        <span id="success-rate" class="result-value">0%</span>
                    </div>
                </div>
                <button id="restart-finish-btn" class="aws-btn">
                    Start New Session
                </button>
            </div>
        </div>

        <!-- Load flashcard data -->
        <script src="aws-flashcards.js"></script>
        <script src="ccco-flashcards.js"></script>
        <script src="ccdak-flashcards.js"></script>

        <script>
            // Theme Management
            const themeToggle = document.getElementById("theme-toggle");
            const themeIcon = themeToggle.querySelector("i");
            const html = document.documentElement;

            // Check for saved theme preference
            const savedTheme = localStorage.getItem("theme") || "light";
            html.setAttribute("data-theme", savedTheme);
            updateThemeToggle(savedTheme);

            // Theme toggle functionality
            themeToggle.addEventListener("click", () => {
                const currentTheme = html.getAttribute("data-theme");
                const newTheme = currentTheme === "light" ? "dark" : "light";

                html.setAttribute("data-theme", newTheme);
                localStorage.setItem("theme", newTheme);
                updateThemeToggle(newTheme);
            });

            function updateThemeToggle(theme) {
                if (theme === "dark") {
                    themeIcon.className = "fas fa-moon";
                } else {
                    themeIcon.className = "fas fa-sun";
                }
            }

            // DOM Elements
            const certSelectScreen =
                document.getElementById("cert-select-screen");
            const cardScreen = document.getElementById("card-screen");
            const finishScreen = document.getElementById("finish-screen");

            const awsCertBtn = document.getElementById("aws-cert");
            const kafkaCertBtn = document.getElementById("kafka-cert");
            const backToCertsFromCardsBtn = document.getElementById(
                "back-to-certs-from-cards",
            );
            const backToCertsFromFinishBtn = document.getElementById(
                "back-to-certs-from-finish",
            );

            const restartBtn = document.getElementById("restart-btn");
            const restartFinishBtn =
                document.getElementById("restart-finish-btn");
            const prevBtn = document.getElementById("prev-btn");
            const nextBtn = document.getElementById("next-btn");
            const flipBtn = document.getElementById("flip-btn");
            const correctBtn = document.getElementById("correct-btn");
            const incorrectBtn = document.getElementById("incorrect-btn");

            const questionEl = document.getElementById("question");
            const answerEl = document.getElementById("answer");
            const flashcard = document.getElementById("flashcard");
            const progressFill = document.getElementById("progress-fill");
            const correctCount = document.getElementById("correct-count");
            const totalCount = document.getElementById("total-count");
            const finalCorrect = document.getElementById("final-correct");
            const finalTotal = document.getElementById("final-total");
            const successRate = document.getElementById("success-rate");

            const certTitle = document.getElementById("cert-title");
            const currentCertTitle =
                document.getElementById("current-cert-title");

            // Flashcard data is loaded from separate script tags above
            // - aws-flashcards.js defines: awsFlashcards
            // - ccco-flashcards.js defines: cccoFlashcards
            // - ccdak-flashcards.js defines: ccdakFlashcards

            // App State
            let flashcards = [];
            let currentCardIndex = 0;
            let correctAnswers = 0;
            let answeredCards = new Set();
            let currentCertification = "";

            // Note: Flashcard data is now imported from separate .js files
            // To add/edit flashcards, edit the respective .js files:
            // - aws-flashcards.js
            // - ccco-flashcards.js
            // - ccdak-flashcards.js

            // Shuffle array using Fisher-Yates algorithm
            function shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }

            // Set certification
            function setCertification(certType) {
                currentCertification = certType;

                if (certType === "aws") {
                    flashcards = awsFlashcards;
                    currentCertTitle.textContent =
                        "AWS Certified Solutions Architect Associate";
                } else if (certType === "kafka") {
                    flashcards = ccdakFlashcards;
                    currentCertTitle.textContent =
                        "Confluent Certified Developer for Apache Kafka";
                } else if (certType === "ccco") {
                    flashcards = cccoFlashcards;
                    currentCertTitle.textContent =
                        "Confluent Certified Cloud Operator";
                }

                // Reset search state
                originalFlashcards = [];
                isFiltering = false;
                searchInput.value = "";
                clearSearchBtn.classList.remove("visible");
                searchResults.classList.remove("visible");

                // Remove filtered mode indicator
                document
                    .querySelector(".feedback-controls")
                    .classList.remove("filtered-mode");

                totalCount.textContent = flashcards.length;
                startSession();
            }

            // Initialize the app
            function initApp() {
                // Add event listeners for certification selection
                awsCertBtn.addEventListener("click", () =>
                    setCertification("aws"),
                );
                kafkaCertBtn.addEventListener("click", () =>
                    setCertification("kafka"),
                );
                document
                    .getElementById("ccco-cert")
                    .addEventListener("click", () => setCertification("ccco"));

                // Add event listeners for back buttons
                backToCertsFromCardsBtn.addEventListener(
                    "click",
                    backToCertSelection,
                );
                backToCertsFromFinishBtn.addEventListener(
                    "click",
                    backToCertSelection,
                );

                // Add event listeners for study session
                restartBtn.addEventListener("click", restartSession);
                restartFinishBtn.addEventListener("click", restartSession);
                prevBtn.addEventListener("click", showPreviousCard);
                nextBtn.addEventListener("click", showNextCard);
                flipBtn.addEventListener("click", flipCard);
                correctBtn.addEventListener("click", () => markCard(true));
                incorrectBtn.addEventListener("click", () => markCard(false));

                // Initialize search functionality
                initSearchFunctionality();
            }

            // Back to certification selection
            function backToCertSelection() {
                // Reset state
                currentCardIndex = 0;
                correctAnswers = 0;
                answeredCards = new Set();
                correctCount.textContent = "0";

                // Reset search state
                originalFlashcards = [];
                isFiltering = false;
                searchInput.value = "";
                clearSearchBtn.classList.remove("visible");
                searchResults.classList.remove("visible");

                // Remove filtered mode indicator
                document
                    .querySelector(".feedback-controls")
                    .classList.remove("filtered-mode");

                showScreen(certSelectScreen);
            }

            // Start a new study session
            function startSession() {
                flashcards = shuffleArray(flashcards);
                currentCardIndex = 0;
                correctAnswers = 0;
                answeredCards = new Set();

                correctCount.textContent = correctAnswers;

                showScreen(cardScreen);
                updateCardDisplay();
            }

            // Restart the session
            function restartSession() {
                startSession();
            }

            // Show a specific screen
            function showScreen(screen) {
                certSelectScreen.classList.remove("active");
                cardScreen.classList.remove("active");
                finishScreen.classList.remove("active");

                screen.classList.add("active");
            }

            // Update the card display
            function updateCardDisplay() {
                if (flashcards.length === 0) {
                    // No matching cards found
                    questionEl.textContent = "No matching cards found";
                    answerEl.textContent = "";

                    // Disable navigation and feedback buttons
                    prevBtn.disabled = true;
                    nextBtn.disabled = true;
                    flipBtn.disabled = true;
                    correctBtn.disabled = true;
                    incorrectBtn.disabled = true;

                    // Update progress bar to 0
                    progressFill.style.width = "0%";
                    return;
                }

                // Re-enable flip button if it was disabled
                flipBtn.disabled = false;

                const currentCard = flashcards[currentCardIndex];

                // Update only the question first
                questionEl.textContent =
                    currentCard.front || currentCard.question;

                // Only update the answer when the card is flipped
                if (flashcard.classList.contains("flipped")) {
                    answerEl.textContent =
                        currentCard.back || currentCard.answer;
                } else {
                    // Clear the answer text when not flipped
                    answerEl.textContent = "";
                }

                // Update progress bar
                const progress =
                    ((currentCardIndex + 1) / flashcards.length) * 100;
                progressFill.style.width = `${progress}%`;

                // Update navigation buttons
                prevBtn.disabled = currentCardIndex === 0;
                nextBtn.disabled = currentCardIndex >= flashcards.length - 1;

                // Disable feedback buttons when card is not flipped
                correctBtn.disabled = true;
                incorrectBtn.disabled = true;

                // Update flip button text
                flipBtn.textContent = "Reveal Answer";
            }

            // Flip the card
            function flipCard() {
                flashcard.classList.toggle("flipped");

                if (flashcard.classList.contains("flipped")) {
                    // Only load the answer content when the card is flipped
                    const currentCard = flashcards[currentCardIndex];
                    answerEl.textContent =
                        currentCard.back || currentCard.answer;

                    flipBtn.textContent = "Hide Answer";
                    // Enable feedback buttons only when card is flipped AND not filtering
                    if (!isFiltering) {
                        correctBtn.disabled = false;
                        incorrectBtn.disabled = false;
                    }
                } else {
                    // Clear the answer when flipping back to front
                    answerEl.textContent = "";

                    flipBtn.textContent = "Reveal Answer";
                    correctBtn.disabled = true;
                    incorrectBtn.disabled = true;
                }
            }

            // Show the previous card
            function showPreviousCard() {
                if (currentCardIndex > 0) {
                    // Reset the card to front side
                    flashcard.classList.remove("flipped");
                    // Clear the answer
                    answerEl.textContent = "";

                    currentCardIndex--;
                    updateCardDisplay();
                }
            }

            // Show the next card
            function showNextCard() {
                if (currentCardIndex < flashcards.length - 1) {
                    // Reset the card to front side
                    flashcard.classList.remove("flipped");
                    // Clear the answer
                    answerEl.textContent = "";

                    currentCardIndex++;
                    updateCardDisplay();
                } else {
                    finishSession();
                }
            }

            // Mark a card as correct or incorrect
            function markCard(isCorrect) {
                // Only count each card once
                if (!answeredCards.has(currentCardIndex)) {
                    if (isCorrect) {
                        correctAnswers++;
                        correctCount.textContent = correctAnswers;
                    }
                    answeredCards.add(currentCardIndex);
                }

                // Reset the card to front side
                flashcard.classList.remove("flipped");
                // Clear the answer
                answerEl.textContent = "";

                if (currentCardIndex < flashcards.length - 1) {
                    currentCardIndex++;
                    updateCardDisplay();
                } else {
                    finishSession();
                }
            }

            // Finish the session
            function finishSession() {
                finalCorrect.textContent = correctAnswers;
                finalTotal.textContent = flashcards.length;

                const rate =
                    flashcards.length > 0
                        ? Math.round((correctAnswers / flashcards.length) * 100)
                        : 0;
                successRate.textContent = `${rate}%`;

                showScreen(finishScreen);
            }

            // Initialize the app when the DOM is loaded
            document.addEventListener("DOMContentLoaded", initApp);

            // Search Functionality
            const searchInput = document.getElementById("search-input");
            const clearSearchBtn = document.getElementById("clear-search");
            const searchResults = document.getElementById("search-results");
            const filteredCount = document.getElementById("filtered-count");

            // Original set of flashcards before filtering
            let originalFlashcards = [];
            let isFiltering = false;

            // Add event listeners for search functionality
            function initSearchFunctionality() {
                searchInput.addEventListener("keyup", function (e) {
                    const query = this.value.trim().toLowerCase();

                    // Show/hide clear button
                    if (query.length > 0) {
                        clearSearchBtn.classList.add("visible");
                    } else {
                        clearSearchBtn.classList.remove("visible");
                    }

                    // If Enter key is pressed, perform search
                    if (e.key === "Enter" && query.length > 0) {
                        performSearch(query);
                    }

                    // If backspace to empty, restore original cards
                    if (query.length === 0 && isFiltering) {
                        clearSearch();
                    }
                });

                clearSearchBtn.addEventListener("click", clearSearch);
            }

            // Perform search on flashcards
            function performSearch(query) {
                if (!isFiltering) {
                    // Store original flashcards if this is the first filter
                    originalFlashcards = [...flashcards];
                    isFiltering = true;
                }

                // Animate card fading out
                flashcard.classList.add("filtering-out");

                // Wait for animation to complete
                setTimeout(() => {
                    // Filter flashcards based on query
                    const filteredCards = originalFlashcards.filter((card) => {
                        const question = (
                            card.front ||
                            card.question ||
                            ""
                        ).toLowerCase();
                        const answer = (
                            card.back ||
                            card.answer ||
                            ""
                        ).toLowerCase();

                        // Match any word in the query against any word in question or answer
                        const queryWords = query
                            .split(" ")
                            .filter((word) => word.length > 0);

                        return queryWords.some(
                            (word) =>
                                question.includes(word) ||
                                answer.includes(word),
                        );
                    });

                    // Update the flashcards array with filtered results
                    flashcards = filteredCards;

                    // Update filtered count
                    filteredCount.textContent = flashcards.length;
                    searchResults.classList.add("visible");

                    // Reset to first card
                    currentCardIndex = 0;
                    // Reset card to front face
                    flashcard.classList.remove("flipped");

                    // Ensure feedback buttons are disabled while filtering
                    correctBtn.disabled = true;
                    incorrectBtn.disabled = true;

                    // Add visual indicator that feedback is disabled during filtering
                    document
                        .querySelector(".feedback-controls")
                        .classList.add("filtered-mode");

                    // Show animation for cards coming back in
                    flashcard.classList.remove("filtering-out");
                    flashcard.classList.add("filtering-in");

                    // Update the display
                    updateCardDisplay();

                    // Remove the filtering-in class after animation completes
                    setTimeout(() => {
                        flashcard.classList.remove("filtering-in");
                    }, 300);
                }, 300); // Match this to the animation duration
            }

            // Clear search and restore original cards
            function clearSearch() {
                if (!isFiltering) return;

                // Animate card fading out
                flashcard.classList.add("filtering-out");

                setTimeout(() => {
                    // Restore original flashcards
                    flashcards = [...originalFlashcards];
                    isFiltering = false;

                    // Clear search input and hide clear button
                    searchInput.value = "";
                    clearSearchBtn.classList.remove("visible");
                    searchResults.classList.remove("visible");

                    // Remove filtered mode indicator
                    document
                        .querySelector(".feedback-controls")
                        .classList.remove("filtered-mode");

                    // Reset to first card
                    currentCardIndex = 0;
                    // Reset card to front face
                    flashcard.classList.remove("flipped");

                    // Show animation for cards coming back in
                    flashcard.classList.remove("filtering-out");
                    flashcard.classList.add("filtering-in");

                    // Update the display
                    updateCardDisplay();

                    // Remove the filtering-in class after animation completes
                    setTimeout(() => {
                        flashcard.classList.remove("filtering-in");
                    }, 300);
                }, 300);
            }
        </script>
    </body>
</html>
